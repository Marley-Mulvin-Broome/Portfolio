<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8" />
		<link rel="icon" href="../favicon.png" />
		<link rel="apple-touch-icon" href="../favicon.png">
		<meta name="viewport" content="width=device-width" />
		<link rel="alternate" type="application/rss+xml" href="/rss.xml" />
		
		<link href="../_app/immutable/assets/0.fa82b7db.css" rel="stylesheet">
		<link href="../_app/immutable/assets/Navbar.e5db1ac2.css" rel="stylesheet">
		<link href="../_app/immutable/assets/6.c8252fe7.css" rel="stylesheet">
		<link rel="modulepreload" href="../_app/immutable/entry/start.3e9b20dc.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/scheduler.68e3df67.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/singletons.68205f7b.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/parse.bee59afc.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/control.f5b05b5f.js">
		<link rel="modulepreload" href="../_app/immutable/entry/app.d991015e.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/preload-helper.a4192956.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/index.ed6dfa59.js">
		<link rel="modulepreload" href="../_app/immutable/nodes/0.5237d4c2.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/index.338842ea.js">
		<link rel="modulepreload" href="../_app/immutable/nodes/2.7de51066.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/Navbar.e26e7285.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/each.e59479a4.js">
		<link rel="modulepreload" href="../_app/immutable/nodes/6.7b640f47.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/Tag.03822683.js"><title>FastAPI &amp; Firebase Emulator for GitHub Workflows (Continuous Integration)</title><!-- HEAD_svelte-1lkfh0n_START --><meta name="description" content="Marley Mulvin Broome is a web developer and current student at the University of New South Wales. Fluent in both Japanese and English."><meta name="keywords" content="marley, mulvin, broome, web, web developer, programmer, hire web, hire developer, website creation, app, dev, github, github stats, hire dev, junior"><meta name="author" content="Marley Mulvin Broome, marley.developer@gmail.com"><meta name="language" content="en"><meta name="robots" content="index,follow"><meta name="revised" content="Sunday, August 13th, 2023, 17:20 pm"><meta charset="utf-8"><meta name="og:title" content="Web Developer Marley Mulvin Broome's Profile"><meta name="og:description" content="Marley Mulvin Broome is a web developer and current student at the University of New South Wales. Fluent in both Japanese and English."><meta name="og:image" content="https://avatars.githubusercontent.com/u/20318132?v=4"><meta name="og:email" content="marley.developer@gmail.com"><!-- HEAD_svelte-1lkfh0n_END --><!-- HEAD_svelte-mr0erh_START --><meta property="og:type" content="article"><meta property="og:title" content="FastAPI &amp; Firebase Emulator for GitHub Workflows (Continuous Integration)"><meta property="og:description" content="Ever wanted to connect your FastaAPI app with a Firebase emulator for easy to implement CI? Here's how to do it."><meta property="og:url" content="https://marley-web.dev/blog/undefined"><meta property="og:image" content="https://marley-web.dev/undefined"><!-- HEAD_svelte-mr0erh_END -->
	</head>
	<body data-sveltekit-preload-data="hover">
		<div style="display: contents">   <div> <nav style="--nav-top: 0%;" class="sticky opacity-100 mx-auto shadow-lg w-fit flex flex-row justify-center rounded-b-md z-10 transition-all svelte-16w0kkm"><a href="/" class="rounded-b-md py-6 px-10 text-emerald-500 hover:bg-gradient-to-br hover:from-emerald-500 hover:to-emerald-600 hover:text-neutral-200 text-xl">Home </a><a href="/blog" class="rounded-b-md py-6 px-10 text-emerald-500 hover:bg-gradient-to-br hover:from-emerald-500 hover:to-emerald-600 hover:text-neutral-200 text-xl">Blog </a><a href="/projects" class="rounded-b-md py-6 px-10 text-emerald-500 hover:bg-gradient-to-br hover:from-emerald-500 hover:to-emerald-600 hover:text-neutral-200 text-xl">Projects </a> </nav>  <article class="flex flex-col text-left mx-auto w-11/12 lg:w-1/2 mt-10 py-6 mb-10 px-4 rounded svelte-xiy5ab"><hgroup><h1 class="lg:text-4xl text-3xl font-bold text-emerald-500">FastAPI &amp; Firebase Emulator for GitHub Workflows (Continuous Integration)</h1> <ul class="pt-4 flex flex-row"><li><p class=" rounded-md bg-emerald-600 text-white px-2 py-1 text-sm mr-2 mb-2">FastAPI </p> </li><li><p class=" rounded-md bg-emerald-600 text-white px-2 py-1 text-sm mr-2 mb-2">Python </p> </li><li><p class=" rounded-md bg-emerald-600 text-white px-2 py-1 text-sm mr-2 mb-2">Firebase </p> </li><li><p class=" rounded-md bg-emerald-600 text-white px-2 py-1 text-sm mr-2 mb-2">CI/CD </p> </li><li><p class=" rounded-md bg-emerald-600 text-white px-2 py-1 text-sm mr-2 mb-2">English </p> </li></ul> <p class="text-sm text-neutral-300">Marley Mulvin Broome, 2023-10-15</p> <img src="/thumb/firebase-fastapi-ci.png" alt="FastAPI &amp; Firebase Emulator for GitHub Workflows (Continuous Integration)" class="pt-5 max-w-full"></hgroup> <div class="prose"><h2 id="the-context" data-svelte-h="svelte-xcblx5">The Context</h2> <p data-svelte-h="svelte-1x9x2ck">In the middle of a hackathon, writing endless lines of serverside code to accomodate our English learning app, I had decided to write tests to
make sure our backend is reliable. Using FastAPI, I had written a few tests to make sure our endpoints were working as expected. However, I didn‚Äôt want to absolutely
wreck our free tier Firestore and authentication, so I needed a better solution for testing. This was where <a href="https://firebase.google.com/docs/emulator-suite" rel="nofollow">Firebase Emulator Suite</a> came in.
Looking online, I couldn‚Äôt find a reliable guide on how to implement it with CI, so I thought I‚Äôd share how I did it.  (Seriously, I googled ‚Äòhow to setup Firebase Emulator FastAPI testing 1 million times!!!)</p> <p data-svelte-h="svelte-1mop6yq">It is VERY easy to integrate Firebase‚Äôs Emulator into GitHub‚Äôs workflows (CI), so don‚Äôt worry too much if you‚Äôre short on time!</p> <h2 id="table-of-contents" data-svelte-h="svelte-ki5nsa">Table of Contents</h2> <ul data-svelte-h="svelte-16bz1v0"><li><a href="#why-firebase-emulator-suite">Why Firebase Emulator Suite?</a></li> <li><a href="#preqrequisites-and-installation">Preqrequisites and Installation</a><ul><li><a href="#initialisation">Initialisation</a></li></ul></li> <li><a href="#starting-firebase-emulator-suite">Starting Firebase Emulator Suite</a></li> <li><a href="#connecting-to-firebase-emulator-suite">Connecting to Firebase Emulator Suite</a><ul><li><a href="#setting-environment-variables">Setting Environment Variables</a></li> <li><a href="#authentication-dependency-override--pyrebase">Authentication Dependency Override &amp; Pyrebase</a></li></ul></li> <li><a href="#the-workflow-file">The workflow file</a></li> <li><a href="#conclusion">Conclusion</a></li></ul> <h2 id="why-firebase-emulator-suite" data-svelte-h="svelte-1ebwvws">Why Firebase Emulator Suite?</h2> <p data-svelte-h="svelte-16bqcco">First of all, you don‚Äôt want to virtually assault your production database with tests. It‚Äôs not a good idea.
You also don‚Äôt want to pay for a separate database for testing. It‚Äôs not a good idea either.</p> <p data-svelte-h="svelte-c5zemz">So a simple solution: use Firebase Emulator Suite. It‚Äôs free, and it‚Äôs easy to use. It‚Äôs also very easy to integrate into your CI pipeline.</p> <h2 id="preqrequisites-and-installation" data-svelte-h="svelte-17pspog">Preqrequisites and Installation</h2> <p data-svelte-h="svelte-1wxwwex">Before you can install Firebase Emulator Suite, you‚Äôre going to need <a href="https://nodejs.org/en/download" rel="nofollow">Node.js</a> version 16+, and <a href="https://jdk.java.net/" rel="nofollow">Java</a> version 11+ installed.
Once you have the prereqs done, you‚Äôre going to want to install the Firebase CLI from <a href="https://firebase.google.com/docs/cli#install_the_firebase_cli" rel="nofollow">here</a>.</p> <h3 id="initialisation" data-svelte-h="svelte-1nboej4">Initialisation</h3> <p data-svelte-h="svelte-1xkaw46">Once you have it installed, you‚Äôre going to want to initialise it. To do this, <strong>cd into your directory</strong> and run the following commands:</p> <!-- HTML_TAG_START --><pre class="shiki monokai" style="background-color: #272822" tabindex="0"><code><span class="line"><span style="color: #A6E22E">firebase</span><span style="color: #F8F8F2"> </span><span style="color: #E6DB74">init</span></span>
<span class="line"><span style="color: #A6E22E">firebase</span><span style="color: #F8F8F2"> </span><span style="color: #E6DB74">init</span><span style="color: #F8F8F2"> </span><span style="color: #E6DB74">emulators</span></span></code></pre><!-- HTML_TAG_END --> <p data-svelte-h="svelte-ildr2z">This will initialise the Firebase CLI and the Firebase Emulator Suite. You will be asked to select which emulators you want to use,
I‚Äôll be going with Authentication and Firestore, but pick all of the ones you‚Äôre using!</p> <h2 id="starting-firebase-emulator-suite" data-svelte-h="svelte-1st8qjh">Starting Firebase Emulator Suite</h2> <p data-svelte-h="svelte-468m1t">To start the Firebase Emulator Suite, you‚Äôre going to want to run the following command:</p> <!-- HTML_TAG_START --><pre class="shiki monokai" style="background-color: #272822" tabindex="0"><code><span class="line"><span style="color: #A6E22E">firebase</span><span style="color: #F8F8F2"> </span><span style="color: #E6DB74">emulators:start</span></span></code></pre><!-- HTML_TAG_END --> <p data-svelte-h="svelte-z4zbbd">This will start the emulator suite, and you should see something like this:
<img src="/img/posts/firebase-emulator-suite.png" alt="Firebase Emulator Suite"></p> <p data-svelte-h="svelte-13lpfqe">Take note of the ports (and url) that the emulators are running on, as you‚Äôll need them later.</p> <h2 id="connecting-to-firebase-emulator-suite" data-svelte-h="svelte-1af5rou">Connecting to Firebase Emulator Suite</h2> <p data-svelte-h="svelte-1n7b2o4">The way that firebase chooses which emulator to connect to is through environment variables. This means, all we have to do
is simply set some environment variables before we run our test command! (In this case, <code>pytest</code>).</p> <p data-svelte-h="svelte-ekyu03">In my case I used <code>FIREBASE_AUTH_EMULATOR_HOST</code> for auth and <code>FIRESTORE_EMULATOR_HOST</code> for Firestore.
Here is a full list if you‚Äôre using anything else:</p> <ul data-svelte-h="svelte-f8metq"><li><a href="https://firebase.google.com/docs/emulator-suite/connect_auth" rel="nofollow">Authentication</a><ul><li><code>FIREBASE_AUTH_EMULATOR_HOST</code></li></ul></li> <li><a href="https://firebase.google.com/docs/emulator-suite/connect_rtdb" rel="nofollow">Realtime Database</a><ul><li><code>FIREBASE_DATABASE_EMULATOR_HOST</code></li></ul></li> <li><a href="https://firebase.google.com/docs/emulator-suite/connect_firestore" rel="nofollow">Firestore</a><ul><li><code>FIRESTORE_EMULATOR_HOST</code></li></ul></li> <li><a href="https://firebase.google.com/docs/emulator-suite/connect_storage" rel="nofollow">Cloud Storage</a><ul><li><code>FIREBASE_STORAGE_EMULATOR_HOST</code></li></ul></li></ul> <p data-svelte-h="svelte-1do4b6o">Cloud functions are a little more involved, see <a href="https://firebase.google.com/docs/emulator-suite/connect_functions" rel="nofollow">this page</a> for further insight!</p> <h3 id="setting-environment-variables" data-svelte-h="svelte-i6r33w">Setting Environment Variables</h3> <p data-svelte-h="svelte-cimfwl">To do this, I wrote a bash script and ran my tests like this <code>./environ_emulator.sh &amp;&amp; ./test.sh</code>. This meant that the environment variables were set
only for the execution of the tests, and didn‚Äôt change anything for my current shell üòé</p> <p data-svelte-h="svelte-1v0uma6">Here is the script:</p> <!-- HTML_TAG_START --><pre class="shiki monokai" style="background-color: #272822" tabindex="0"><code><span class="line"><span style="color: #88846F">#!/bin/bash</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F92672">export</span><span style="color: #F8F8F2"> OMNIA_ENV</span><span style="color: #F92672">=</span><span style="color: #E6DB74">&quot;emulator&quot;</span></span>
<span class="line"><span style="color: #F92672">export</span><span style="color: #F8F8F2"> FIREBASE_AUTH_EMULATOR_HOST</span><span style="color: #F92672">=</span><span style="color: #E6DB74">&quot;127.0.0.1:9099&quot;</span></span>
<span class="line"><span style="color: #F92672">export</span><span style="color: #F8F8F2"> FIRESTORE_EMULATOR_HOST</span><span style="color: #F92672">=</span><span style="color: #E6DB74">&quot;127.0.0.1:8080&quot;</span></span></code></pre><!-- HTML_TAG_END --> <p data-svelte-h="svelte-17bwyz0">I set an extra variable <code>OMNIA_ENV</code> which is just to tell the server that it‚Äôs in an emulated environment.
This is because I use <a href="https://github.com/nhorvath/Pyrebase4" rel="nofollow">Pyrebase</a> for email and password login, and it is sadly hardcoded to use the production URLs for password authentication (I believe, correct me if I‚Äôm wrong!)
If you are using Pyrebase as well for this, please be careful, and if you find a good way to integrate it let me know!!!!</p> <h3 id="authentication-dependency-override--pyrebase" data-svelte-h="svelte-1vo5kg">Authentication Dependency Override &amp; Pyrebase</h3> <p data-svelte-h="svelte-hy60a8">Because of various issues relating to the Admin SDK being limited, and being unable to use Pyrebase in a testing environment, I made the following override for authentication. With this, tests would fail if it wasn‚Äôt in the emulator environment as well, so no unwanted production data touched.</p> <!-- HTML_TAG_START --><pre class="shiki monokai" style="background-color: #272822" tabindex="0"><code><span class="line"><span style="color: #66D9EF; font-style: italic">def</span><span style="color: #F8F8F2"> </span><span style="color: #A6E22E">override_validate_token</span><span style="color: #F8F8F2">(</span><span style="color: #FD971F; font-style: italic">x_uid</span><span style="color: #F8F8F2">: </span><span style="color: #66D9EF; font-style: italic">str</span><span style="color: #F8F8F2"> </span><span style="color: #F92672">=</span><span style="color: #F8F8F2"> Header()) -&gt; </span><span style="color: #66D9EF; font-style: italic">dict</span><span style="color: #F8F8F2">:</span></span>
<span class="line"><span style="color: #F8F8F2">    </span><span style="color: #E6DB74">&quot;&quot;&quot;</span></span>
<span class="line"><span style="color: #E6DB74">    „Éà„Éº„ÇØ„É≥„Çí„Éò„ÉÉ„ÉÄ„Éº„ÅßÂèó„ÅëÂèñ„Çä„ÄÅÊ§úË®º„Åô„Çã</span></span>
<span class="line"><span style="color: #E6DB74">    &quot;&quot;&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F8F8F2">    user </span><span style="color: #F92672">=</span><span style="color: #F8F8F2"> auth.get_user(x_uid)</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F8F8F2">    </span><span style="color: #F92672">return</span><span style="color: #F8F8F2"> &#123;</span></span>
<span class="line"><span style="color: #F8F8F2">        </span><span style="color: #E6DB74">&quot;token&quot;</span><span style="color: #F8F8F2">: </span><span style="color: #E6DB74">&quot;fake token&quot;</span><span style="color: #F8F8F2">,</span></span>
<span class="line"><span style="color: #F8F8F2">        </span><span style="color: #E6DB74">&quot;user&quot;</span><span style="color: #F8F8F2">: &#123;</span></span>
<span class="line"><span style="color: #F8F8F2">            </span><span style="color: #E6DB74">&quot;uid&quot;</span><span style="color: #F8F8F2">: user.uid,</span></span>
<span class="line"><span style="color: #F8F8F2">            </span><span style="color: #E6DB74">&quot;email&quot;</span><span style="color: #F8F8F2">: user.email,</span></span>
<span class="line"><span style="color: #F8F8F2">        &#125;,</span></span>
<span class="line"><span style="color: #F8F8F2">    &#125;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #88846F"># ...</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F8F8F2">app.dependency_overrides[validate_token] </span><span style="color: #F92672">=</span><span style="color: #F8F8F2"> override_validate_token</span></span></code></pre><!-- HTML_TAG_END --> <p data-svelte-h="svelte-7o84ug">Additionally, I added some environment variable checks to fail tests if they weren‚Äôt set</p> <!-- HTML_TAG_START --><pre class="shiki monokai" style="background-color: #272822" tabindex="0"><code><span class="line"><span style="color: #F92672">if</span><span style="color: #F8F8F2"> </span><span style="color: #E6DB74">&quot;OMNIA_ENV&quot;</span><span style="color: #F8F8F2"> </span><span style="color: #F92672">not</span><span style="color: #F8F8F2"> </span><span style="color: #F92672">in</span><span style="color: #F8F8F2"> environ </span><span style="color: #F92672">or</span><span style="color: #F8F8F2"> environ[</span><span style="color: #E6DB74">&quot;OMNIA_ENV&quot;</span><span style="color: #F8F8F2">] </span><span style="color: #F92672">!=</span><span style="color: #F8F8F2"> </span><span style="color: #E6DB74">&quot;emulator&quot;</span><span style="color: #F8F8F2">:</span></span>
<span class="line"><span style="color: #F8F8F2">    </span><span style="color: #F92672">assert</span><span style="color: #F8F8F2"> </span><span style="color: #AE81FF">False</span><span style="color: #F8F8F2">, </span><span style="color: #E6DB74">&quot;OMNIA_ENV„ÅåË®≠ÂÆö„Åï„Çå„Å¶„ÅÑ„Åæ„Åõ„Çì„ÄÅ„Åæ„Åü„ÅØemulator„Åß„ÅØ„ÅÇ„Çä„Åæ„Åõ„Çì&quot;</span></span>
<span class="line"><span style="color: #F92672">if</span><span style="color: #F8F8F2"> </span><span style="color: #E6DB74">&quot;FIRESTORE_EMULATOR_HOST&quot;</span><span style="color: #F8F8F2"> </span><span style="color: #F92672">not</span><span style="color: #F8F8F2"> </span><span style="color: #F92672">in</span><span style="color: #F8F8F2"> environ:</span></span>
<span class="line"><span style="color: #F8F8F2">    </span><span style="color: #F92672">assert</span><span style="color: #F8F8F2"> </span><span style="color: #AE81FF">False</span><span style="color: #F8F8F2">, </span><span style="color: #E6DB74">&quot;FIRESTORE_EMULATOR_HOST„ÅåË®≠ÂÆö„Åï„Çå„Å¶„ÅÑ„Åæ„Åõ„Çì&quot;</span></span>
<span class="line"><span style="color: #F92672">if</span><span style="color: #F8F8F2"> </span><span style="color: #E6DB74">&quot;FIREBASE_AUTH_EMULATOR_HOST&quot;</span><span style="color: #F8F8F2"> </span><span style="color: #F92672">not</span><span style="color: #F8F8F2"> </span><span style="color: #F92672">in</span><span style="color: #F8F8F2"> environ:</span></span>
<span class="line"><span style="color: #F8F8F2">    </span><span style="color: #F92672">assert</span><span style="color: #F8F8F2"> </span><span style="color: #AE81FF">False</span><span style="color: #F8F8F2">, </span><span style="color: #E6DB74">&quot;FIREBASE_AUTH_EMULATOR_HOST„ÅåË®≠ÂÆö„Åï„Çå„Å¶„ÅÑ„Åæ„Åõ„Çì&quot;</span></span></code></pre><!-- HTML_TAG_END --> <h2 id="the-workflow-file" data-svelte-h="svelte-1wcx418">The workflow file</h2> <!-- HTML_TAG_START --><pre class="shiki monokai" style="background-color: #272822" tabindex="0"><code><span class="line"></span>
<span class="line"><span style="color: #F92672">name</span><span style="color: #F8F8F2">: </span><span style="color: #E6DB74">Python lint and test</span></span>
<span class="line"></span>
<span class="line"><span style="color: #AE81FF">on</span><span style="color: #F8F8F2">:</span></span>
<span class="line"><span style="color: #F8F8F2">  </span><span style="color: #F92672">push</span><span style="color: #F8F8F2">:</span></span>
<span class="line"><span style="color: #F8F8F2">    </span><span style="color: #F92672">branches</span><span style="color: #F8F8F2">: [</span><span style="color: #E6DB74">master</span><span style="color: #F8F8F2">, </span><span style="color: #E6DB74">dev</span><span style="color: #F8F8F2">]</span></span>
<span class="line"><span style="color: #F8F8F2">    </span><span style="color: #F92672">paths</span><span style="color: #F8F8F2">: [</span><span style="color: #E6DB74">&quot;.github/workflows/firebase-python-ci.yaml&quot;</span><span style="color: #F8F8F2">, </span><span style="color: #E6DB74">&quot;server/**&quot;</span><span style="color: #F8F8F2">]</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F92672">jobs</span><span style="color: #F8F8F2">:</span></span>
<span class="line"><span style="color: #F8F8F2">  </span><span style="color: #F92672">test</span><span style="color: #F8F8F2">:</span></span>
<span class="line"><span style="color: #F8F8F2">    </span><span style="color: #F92672">runs-on</span><span style="color: #F8F8F2">: </span><span style="color: #E6DB74">ubuntu-latest</span></span>
<span class="line"><span style="color: #F8F8F2">      </span></span>
<span class="line"><span style="color: #F8F8F2">    </span><span style="color: #F92672">steps</span><span style="color: #F8F8F2">:</span></span>
<span class="line"><span style="color: #F8F8F2">      - </span><span style="color: #F92672">uses</span><span style="color: #F8F8F2">: </span><span style="color: #E6DB74">actions/checkout@v4</span></span>
<span class="line"><span style="color: #F8F8F2">      - </span><span style="color: #F92672">name</span><span style="color: #F8F8F2">: </span><span style="color: #E6DB74">Set up Python 3.10</span></span>
<span class="line"><span style="color: #F8F8F2">        </span><span style="color: #F92672">uses</span><span style="color: #F8F8F2">: </span><span style="color: #E6DB74">actions/setup-python@v4</span></span>
<span class="line"><span style="color: #F8F8F2">        </span><span style="color: #F92672">with</span><span style="color: #F8F8F2">:</span></span>
<span class="line"><span style="color: #F8F8F2">          </span><span style="color: #F92672">python-version</span><span style="color: #F8F8F2">: </span><span style="color: #E6DB74">&#39;3.10&#39;</span></span>
<span class="line"><span style="color: #F8F8F2">          </span><span style="color: #F92672">cache</span><span style="color: #F8F8F2">: </span><span style="color: #E6DB74">&#39;pip&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F8F8F2">      - </span><span style="color: #F92672">name</span><span style="color: #F8F8F2">: </span><span style="color: #E6DB74">Install dependencies</span></span>
<span class="line"><span style="color: #F8F8F2">        </span><span style="color: #F92672">working-directory</span><span style="color: #F8F8F2">: </span><span style="color: #E6DB74">./server</span></span>
<span class="line"><span style="color: #F8F8F2">        </span><span style="color: #F92672">run</span><span style="color: #F8F8F2">: </span><span style="color: #F92672">|</span></span>
<span class="line"><span style="color: #E6DB74">          python -m pip install --upgrade pip</span></span>
<span class="line"><span style="color: #E6DB74">          pip install -r requirements.txt</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color: #F8F8F2">      - </span><span style="color: #F92672">name</span><span style="color: #F8F8F2">: </span><span style="color: #E6DB74">Install Node.js 18.x for Firebase</span></span>
<span class="line"><span style="color: #F8F8F2">        </span><span style="color: #F92672">uses</span><span style="color: #F8F8F2">: </span><span style="color: #E6DB74">actions/setup-node@v2</span></span>
<span class="line"><span style="color: #F8F8F2">        </span><span style="color: #F92672">with</span><span style="color: #F8F8F2">:</span></span>
<span class="line"><span style="color: #F8F8F2">          </span><span style="color: #F92672">node-version</span><span style="color: #F8F8F2">: </span><span style="color: #E6DB74">&#39;18.x&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F8F8F2">      - </span><span style="color: #F92672">name</span><span style="color: #F8F8F2">: </span><span style="color: #E6DB74">Install Java 17</span></span>
<span class="line"><span style="color: #F8F8F2">        </span><span style="color: #F92672">uses</span><span style="color: #F8F8F2">: </span><span style="color: #E6DB74">actions/setup-java@v3</span></span>
<span class="line"><span style="color: #F8F8F2">        </span><span style="color: #F92672">with</span><span style="color: #F8F8F2">:</span></span>
<span class="line"><span style="color: #F8F8F2">          </span><span style="color: #F92672">java-version</span><span style="color: #F8F8F2">: </span><span style="color: #E6DB74">&#39;17.x&#39;</span></span>
<span class="line"><span style="color: #F8F8F2">          </span><span style="color: #F92672">distribution</span><span style="color: #F8F8F2">: </span><span style="color: #E6DB74">&#39;temurin&#39;</span></span>
<span class="line"><span style="color: #F8F8F2">           </span></span>
<span class="line"><span style="color: #F8F8F2">      - </span><span style="color: #F92672">name</span><span style="color: #F8F8F2">: </span><span style="color: #E6DB74">Install Firebase CLI</span></span>
<span class="line"><span style="color: #F8F8F2">        </span><span style="color: #F92672">run</span><span style="color: #F8F8F2">: </span><span style="color: #F92672">|</span></span>
<span class="line"><span style="color: #E6DB74">          curl -sL https://firebase.tools | bash</span></span>
<span class="line"><span style="color: #E6DB74">      </span></span>
<span class="line"><span style="color: #F8F8F2">      - </span><span style="color: #F92672">name</span><span style="color: #F8F8F2">: </span><span style="color: #E6DB74">Cache Firebase CLI</span></span>
<span class="line"><span style="color: #F8F8F2">        </span><span style="color: #F92672">uses</span><span style="color: #F8F8F2">: </span><span style="color: #E6DB74">actions/cache@v3</span></span>
<span class="line"><span style="color: #F8F8F2">        </span><span style="color: #F92672">with</span><span style="color: #F8F8F2">:</span></span>
<span class="line"><span style="color: #F8F8F2">          </span><span style="color: #F92672">path</span><span style="color: #F8F8F2">: </span><span style="color: #E6DB74">~/.cache/firebase</span></span>
<span class="line"><span style="color: #F8F8F2">          </span><span style="color: #F92672">key</span><span style="color: #F8F8F2">: </span><span style="color: #E6DB74">$&#123;&#123; runner.os &#125;&#125;-firebase-$&#123;&#123; hashFiles(&#39;**/firebase.json&#39;) &#125;&#125;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F8F8F2">      - </span><span style="color: #F92672">name</span><span style="color: #F8F8F2">: </span><span style="color: #E6DB74">Run tests with pytest and Firebase Emulator</span></span>
<span class="line"><span style="color: #F8F8F2">        </span><span style="color: #F92672">working-directory</span><span style="color: #F8F8F2">: </span><span style="color: #E6DB74">./server</span></span>
<span class="line"><span style="color: #F8F8F2">        </span><span style="color: #F92672">env</span><span style="color: #F8F8F2">:</span></span>
<span class="line"><span style="color: #F8F8F2">          </span><span style="color: #88846F"># ...</span></span>
<span class="line"><span style="color: #F8F8F2">          </span><span style="color: #F92672">SERVICE_ACCOUNT_FILE</span><span style="color: #F8F8F2">: </span><span style="color: #E6DB74">$&#123;&#123; secrets.SERVICE_ACCOUNT &#125;&#125;</span></span>
<span class="line"><span style="color: #F8F8F2">        </span><span style="color: #F92672">run</span><span style="color: #F8F8F2">: </span><span style="color: #F92672">|</span></span>
<span class="line"><span style="color: #E6DB74">          echo &quot;$SERVICE_ACCOUNT_FILE&quot; &gt; service_account.json</span></span>
<span class="line"><span style="color: #E6DB74">          firebase emulators:exec &#39;./test.sh&#39; --token &quot;$&#123;FIREBASE_TOKEN&#125;&quot;</span></span></code></pre><!-- HTML_TAG_END --> <p data-svelte-h="svelte-pj4die">This is a very rough, but working workflow I used in the hackathon project. Here is a breakdown of what it does:</p> <ul data-svelte-h="svelte-13u3h7x"><li><p>First we use the <strong>on</strong> key to say, ‚Äòonly run this workflow on <strong>pushes</strong> to master and dev if there were <strong>changes</strong> to the server or workflow file‚Äô.
As we had multiple projects in the same repo for convenience, I didn‚Äôt want this to run whenever anyone made some unrelated change.</p></li> <li><p>Next we run this on <code>ubuntu</code>, because we are going to <em>probably</em> be deploying there. You should make sure it‚Äôs the environment you‚Äôre going to be deploying to as well.</p></li> <li><p>Our first twos steps are to install python and its dependencies. We use the action <code>setup-python@v4</code> to get python and pip install.
In this project I was using and deploying on <strong>Python 10</strong>, but you should change this depending on your own project.</p></li> <li><p>Before we can run the emulator, we must install the preqrequisites for it. Particularly Java &amp; Node JS. This is done with the <code>setup-node@v2</code> and <code>setup-java@v3</code> actions.
You can also look into <strong>caching</strong> <a href="https://docs.github.com/ja/actions/using-workflows/caching-dependencies-to-speed-up-workflows" rel="nofollow">here</a> to make your workflows super fast.</p></li> <li><p>Then, we install the CLI with this command <code>curl -sL https://firebase.tools | bash</code>.</p></li> <li><p>To make sure we don‚Äôt install Firebase each time, we cache it with the <code>cache@v3</code> action. I believe this snippet is taken from the firebase docs if you are interested.</p></li> <li><p>Finally, we actually <strong>run</strong> our tests. It is important to get our GitHub secrets and set them as environment variables with the ‚Äòenv‚Äô directive.
This is especially important for your <strong>FIREBASE_TOKEN</strong> to authenticate yourself. To run our tests, we use the <code>firebase emulators:exec</code> command.
This is because Firebase <strong>hogs</strong> the shell, meaning if we tried running another command after it wouldn‚Äôt happen until it closed, which defeats the purpose.</p></li></ul> <h2 id="conclusion" data-svelte-h="svelte-1cykd0u">Conclusion</h2> <p data-svelte-h="svelte-1xkerrs">In conclusion, we used the Firebase Emulator Suite to create a nice local testing environment for our FastAPI &amp; Firebase app.
First we setup the firebase CLI, ran our emulator, then set our environment variables for testing.
If you want to ever lookback and remember how to setup FastAPI and Firebase Emulator Suite, then please bookmark this article for future reference!</p> <p data-svelte-h="svelte-6mpbyb">Happy hacking! üéâ</p></div> </article></div> 
			
			<script>
				{
					__sveltekit_1wfkvhx = {
						base: new URL("..", location).pathname.slice(0, -1),
						env: {"PUBLIC_CAPTCHA_KEY":"6LeuCqUnAAAAAN7u6e3IYMusjwIGEuFEJPiXQ_r1"}
					};

					const element = document.currentScript.parentElement;

					const data = [null,null,null];

					Promise.all([
						import("../_app/immutable/entry/start.3e9b20dc.js"),
						import("../_app/immutable/entry/app.d991015e.js")
					]).then(([kit, app]) => {
						kit.start(app, element, {
							node_ids: [0, 2, 6],
							data,
							form: null,
							error: null
						});
					});
				}
			</script>
		</div>
	</body>
</html>
